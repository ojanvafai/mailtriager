<style>
.elide { color: red; background-color: black; }
</style>
<script src="static/differ.js"></script>
<script>
let windowSize = 3;
let minimumLength = 8;
let differ = new Differ('<span class="elide">', '</span>', windowSize, minimumLength);

function test(current, previous, expected) {
  let result = differ.diff(current, previous);
  if (result == expected) {
    console.log(`PASSED. Got: ${result}`);
  } else {
    console.log(`FAILED. expected: ${expected}, got: ${result}`);
  }
}

// Basic overlap with extrending fron and back
test(`green bananas wut`, `wild bananas stink`, `green<span class="elide"> bananas </span>wut`);
// Mimimum length.
test(`green cars wut`, `wild cars stink`, `green cars wut`);
// Beginning matches
test(`green bananas wut`, `green bananas stink`, `<span class="elide">green bananas </span>wut`);
// End matches
test(`green bananas wut`, `wild bananas wut`, `green<span class="elide"> bananas wut</span>`);
// All matches
test(`green bananas`, `green bananas`, `<span class="elide">green bananas</span>`);
// Multiple matches
test(`green bananas best bananas in the world`,
    `yellow bananas worst bananas in the world`,
    `green<span class="elide"> bananas </span>be<span class="elide">st bananas in the world</span>`);
// Mismatched markup
test(`<div>foo</div>bar`, `<span>foo</span>bar`, `<div>foo</div>bar`);

// Basic html
test(`<div>grow</div> bananas`, `wild bananas`, `<div>grow</div><span class="elide"> bananas</span>`);

// TODO: Don't break up markup?
// This one is expecting a broken result at the moment.
test(`<div>green</div> bananas<div> wut</div>`,
    `wild bananas stink`,
    `<div>green</div><span class="elide"> bananas</span><div> wut</div>`);

// Multiple matches, but only one match in the original, so the longest should win.
test(`reply Full Name &lt;username@foo.com&gt; original message Full Name username@foo.com`,
    `original message Full Name username@foo.com`,
    `reply<span class="elide"> Full Name </span>&lt;<span class="elide">username@foo.com</span>&gt; <span class="elide">original message Full Name username@foo.com</span>`);

test(`a b<div>abcdefgh<a>c</a></div>`,
    `b<div>abcdefgh<a>c</a></div>`,
    `a <span class="elide">b<div>abcdefgh<a>c</a></div></span>`);

test(`foob<div>a <a>bar@foo.com</a></div>`,
    `b<div>a <a>bar@foo.com</a></div>`,
    `foo<span class="elide">b<div>a <a>bar@foo.com</a></div></span>`);

let previous = `hello<div>Full Name <a>bar@foo.com</a></div>`;
let current =
`goodbye<div>On Jun 7 Full Name &lt;<a>bar@foo.com</a>&gt; wrote:</div>hello<div>Full Name <a>bar@foo.com</a></div>`;
let expected = `goodbye<div>On Jun 7 <span class="elide">Full Name </span>&lt;<span class="elide"><a>bar@foo.com</a></span>&gt; wrote:</div><span class="elide">hello<div>Full Name <a>bar@foo.com</a></div></span>`;
test(current, previous, expected);

function log(title, content) {
  let h1 = document.createElement('h3');
  h1.textContent = title;
  document.documentElement.append(h1);
  let div = document.createElement('div');
  div.innerHTML = content;
  document.documentElement.appendChild(div);
}
log('current', current);
log('previous', previous);
log('result', differ.diff(current, previous));
</script>
